# λ°±μ—”λ“ μ¤ν”„λ§ μμ • μ μ•μ„

## π“‹ ν„μ¬ μƒν™©

### β… μ΄λ―Έ κµ¬ν„λ κ²ƒ
- `POST /api/v1/words` - λ‹¨μ–΄ μ €μ¥ API (κ²½λ΅λ” `/api/words`λ΅ λ³€κ²½ ν•„μ”)
- `Word` Entity, `WordRepository`, `WordService` κΈ°λ³Έ κµ¬μ΅°
- `WordRequest`, `WordResponse` DTO

### β κµ¬ν„μ΄ ν•„μ”ν• κ²ƒ
μ•λ“λ΅μ΄λ“ μ•±μ—μ„ μ‚¬μ©ν•λ” λ‹¤μ APIλ“¤μ΄ **μ „λ¶€ μ—†μ**:
1. `GET /api/words?user_id=xxx` - μ‚¬μ©μμ λ¨λ“  λ‹¨μ–΄ μ΅°ν
2. `GET /api/words/since?user_id=xxx&since=timestamp` - μ¦λ¶„ λ™κΈ°ν™”
3. `GET /api/words/count?user_id=xxx&since=timestamp` - μƒ λ‹¨μ–΄ κ°μ μ΅°ν (λ±ƒμ§€μ©)
4. `GET /api/words/{id}` - νΉμ • λ‹¨μ–΄ μ΅°ν
5. `PUT /api/words/{id}` - λ‹¨μ–΄ μμ •
6. `DELETE /api/words/{id}` - λ‹¨μ–΄ μ‚­μ 

### β οΈ λ¬Έμ μ 
1. **API κ²½λ΅ λ¶μΌμΉ**: 
   - λ°±μ—”λ“ `WordController`λ” `/api/v1/words` μ‚¬μ© (λ‹¤λ¥Έ μ»¨νΈλ΅¤λ¬λ“¤μ€ `/api/xxx` ν¨ν„΄)
   - μ•λ“λ΅μ΄λ“λ” `/api/words` μ‚¬μ©
   - **ν•΄κ²°**: `WordController`μ `@RequestMapping`μ„ `/api/words`λ΅ λ³€κ²½ ν•„μ”
2. **λ€λ¶€λ¶„μ GET μ—”λ“ν¬μΈνΈ λ¶€μ¬**: μ΅°ν APIκ°€ κ±°μ μ—†μ
3. **μ¦λ¶„ λ™κΈ°ν™” λ΅μ§ μ—†μ**: `createdAt`/`updatedAt` κΈ°λ° ν•„ν„°λ§ ν•„μ”
4. **WordCountResponse DTO μ—†μ**: λ±ƒμ§€μ© κ°μ μ΅°ν APIμ— ν•„μ”

---

## π”§ μμ •μ΄ ν•„μ”ν• νμΌλ“¤

### 1. `WordController.java` - μ—”λ“ν¬μΈνΈ μ¶”κ°€

**ν„μ¬ μƒνƒ**: `POST /api/v1/words`λ§ μμ

**μ¶”κ°€ν•΄μ•Ό ν•  μ—”λ“ν¬μΈνΈ**:
```java
@RestController
@RequestMapping("/api/words")  // κ²½λ΅ λ³€κ²½: /api/v1/words β†’ /api/words
@CrossOrigin(origins = "*")
@RequiredArgsConstructor
public class WordController {
    
    // β… μ΄λ―Έ μμ
    @PostMapping
    public ResponseEntity<?> saveWord(@Valid @RequestBody WordRequest request)
    
    // β μ¶”κ°€ ν•„μ”
    @GetMapping
    public ResponseEntity<?> getWordsByUserId(@RequestParam("user_id") String userId)
    
    // β μ¶”κ°€ ν•„μ”
    @GetMapping("/since")
    public ResponseEntity<?> getWordsSince(
        @RequestParam("user_id") String userId,
        @RequestParam("since") long timestamp)
    
    // β μ¶”κ°€ ν•„μ”
    @GetMapping("/count")
    public ResponseEntity<?> getNewWordCount(
        @RequestParam("user_id") String userId,
        @RequestParam("since") long timestamp)
    
    // β μ¶”κ°€ ν•„μ”
    @GetMapping("/{id}")
    public ResponseEntity<?> getWordById(@PathVariable Long id)
    
    // β μ¶”κ°€ ν•„μ”
    @PutMapping("/{id}")
    public ResponseEntity<?> updateWord(
        @PathVariable Long id,
        @Valid @RequestBody WordRequest request)
    
    // β μ¶”κ°€ ν•„μ”
    @DeleteMapping("/{id}")
    public ResponseEntity<?> deleteWord(@PathVariable Long id)
}
```

---

### 2. `WordService.java` - λΉ„μ¦λ‹μ¤ λ΅μ§ μ¶”κ°€

**ν„μ¬ μƒνƒ**: `saveWord()`λ§ μμ

**μ¶”κ°€ν•΄μ•Ό ν•  λ©”μ„λ“**:
```java
@Service
@RequiredArgsConstructor
public class WordService {
    
    // β… μ΄λ―Έ μμ
    public WordResponse saveWord(WordRequest request)
    
    // β μ¶”κ°€ ν•„μ”
    public List<WordResponse> getWordsByUserId(String userId)
    
    // β μ¶”κ°€ ν•„μ”
    public List<WordResponse> getWordsSince(String userId, long timestamp)
    
    // β μ¶”κ°€ ν•„μ”
    public int getNewWordCount(String userId, long timestamp)
    
    // β μ¶”κ°€ ν•„μ”
    public WordResponse getWordById(Long id)
    
    // β μ¶”κ°€ ν•„μ”
    public WordResponse updateWord(Long id, WordRequest request)
    
    // β μ¶”κ°€ ν•„μ”
    public void deleteWord(Long id)
}
```

---

### 3. `WordRepository.java` - μΏΌλ¦¬ λ©”μ„λ“ μ¶”κ°€

**ν„μ¬ μƒνƒ**: 
- `findByUserId(String userId)`
- `existsByUserIdAndWord(String userId, String word)`

**μ¶”κ°€ν•΄μ•Ό ν•  λ©”μ„λ“**:
```java
@Repository
public interface WordRepository extends JpaRepository<Word, Long> {
    
    // β… μ΄λ―Έ μμ
    List<Word> findByUserId(String userId);
    boolean existsByUserIdAndWord(String userId, String word);
    
    // β μ¶”κ°€ ν•„μ”: μ¦λ¶„ λ™κΈ°ν™”μ© (timestamp μ΄ν›„ μƒμ„±/μμ •λ λ‹¨μ–΄)
    @Query("SELECT w FROM Word w WHERE w.userId = :userId " +
           "AND (w.createdAt >= :timestamp OR w.updatedAt >= :timestamp) " +
           "ORDER BY w.updatedAt DESC")
    List<Word> findByUserIdAndUpdatedAfter(
        @Param("userId") String userId,
        @Param("timestamp") LocalDateTime timestamp);
    
    // β μ¶”κ°€ ν•„μ”: λ±ƒμ§€μ© κ°μ μ΅°ν
    @Query("SELECT COUNT(w) FROM Word w WHERE w.userId = :userId " +
           "AND (w.createdAt >= :timestamp OR w.updatedAt >= :timestamp)")
    long countByUserIdAndUpdatedAfter(
        @Param("userId") String userId,
        @Param("timestamp") LocalDateTime timestamp);
}
```

**μ£Όμμ‚¬ν•­**: 
- `timestamp`λ” `long` (λ°€λ¦¬μ΄)λ΅ λ°›μ§€λ§, DBμ—μ„λ” `LocalDateTime`μΌλ΅ λΉ„κµν•΄μ•Ό ν•¨
- `long` β†’ `LocalDateTime` λ³€ν™ λ΅μ§ ν•„μ”

---

### 4. `WordResponse.java` - ν•„λ“ ν™•μΈ

**ν„μ¬ μƒνƒ**: 
```java
private Long id;
private String word;
private String translation;
private String pronunciation;
private String example;
private LocalDateTime createdAt;
private LocalDateTime updatedAt;
```

**ν™•μΈ ν•„μ”**: 
- μ•λ“λ΅μ΄λ“ `WordResponse`μ—λ” `userId` ν•„λ“κ°€ μ—†μ§€λ§, ν•„μ”ν•λ©΄ μ¶”κ°€ κ°€λ¥
- ν„μ¬ κµ¬μ΅°λ΅λ„ μ¶©λ¶„ν λ™μ‘ κ°€λ¥ (μ•λ“λ΅μ΄λ“μ—μ„ `userId`λ” λ³„λ„λ΅ κ΄€λ¦¬)

---

### 5. `WordCountResponse.java` - μƒ DTO μƒμ„± ν•„μ”

**μ„μΉ**: `com.nimda.cup.word.dto.WordCountResponse`

**λ‚΄μ©**:
```java
package com.nimda.cup.word.dto;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class WordCountResponse {
    private int count; // μƒλ΅ μ¶”κ°€λ λ‹¨μ–΄ κ°μ
}
```

---

## π”„ νƒ€μ„μ¤νƒ¬ν”„ λ³€ν™ λ΅μ§

### λ¬Έμ 
- μ•λ“λ΅μ΄λ“: `long` (λ°€λ¦¬μ΄, Unix timestamp)
- λ°±μ—”λ“: `LocalDateTime` (Java 8+ νƒ€μ„μ΅΄ μΈμ‹)

### ν•΄κ²° λ°©λ²•
```java
// WordService.javaμ— μ ν‹Έλ¦¬ν‹° λ©”μ„λ“ μ¶”κ°€
private LocalDateTime timestampToLocalDateTime(long timestamp) {
    return LocalDateTime.ofInstant(
        Instant.ofEpochMilli(timestamp),
        ZoneId.systemDefault()
    );
}

// μ‚¬μ© μμ‹
public List<WordResponse> getWordsSince(String userId, long timestamp) {
    LocalDateTime since = timestampToLocalDateTime(timestamp);
    List<Word> words = wordRepository.findByUserIdAndUpdatedAfter(userId, since);
    return words.stream()
        .map(WordResponse::from)
        .collect(Collectors.toList());
}
```

---

## π“ κµ¬ν„ μ°μ„ μμ„

### 1μμ„ (ν•„μ - λ±ƒμ§€ κΈ°λ¥ λ™μ‘)
- β… `WordCountResponse.java` μƒμ„±
- β… `GET /api/words/count` μ—”λ“ν¬μΈνΈ
- β… `WordService.getNewWordCount()` λ©”μ„λ“
- β… `WordRepository.countByUserIdAndUpdatedAfter()` μΏΌλ¦¬

### 2μμ„ (ν•„μ - λ™κΈ°ν™” κΈ°λ¥ λ™μ‘)
- β… `GET /api/words?user_id=xxx` μ—”λ“ν¬μΈνΈ
- β… `GET /api/words/since?user_id=xxx&since=timestamp` μ—”λ“ν¬μΈνΈ
- β… `WordService.getWordsByUserId()`, `getWordsSince()` λ©”μ„λ“
- β… `WordRepository.findByUserIdAndUpdatedAfter()` μΏΌλ¦¬
- β… νƒ€μ„μ¤νƒ¬ν”„ λ³€ν™ λ΅μ§

### 3μμ„ (μ„ νƒ - CRUD μ™„μ„±)
- β… `GET /api/words/{id}` μ—”λ“ν¬μΈνΈ
- β… `PUT /api/words/{id}` μ—”λ“ν¬μΈνΈ
- β… `DELETE /api/words/{id}` μ—”λ“ν¬μΈνΈ
- β… `WordService`μ— ν•΄λ‹Ή λ©”μ„λ“λ“¤ μ¶”κ°€

### 0μμ„ (μµμ°μ„  - κ²½λ΅ ν†µμΌ)
- β… `WordController`μ `@RequestMapping("/api/v1/words")` β†’ `@RequestMapping("/api/words")` λ³€κ²½
- λ‹¤λ¥Έ λ¨λ“  μ»¨νΈλ΅¤λ¬(`/api/judge`, `/api/users`, `/api/groups` λ“±)μ™€ μΌκ΄€μ„± μ μ§€

---

## π― μ”μ•½

### κ°€μ¥ μ‹κΈ‰ν• μ‘μ—…
1. **λ±ƒμ§€ κΈ°λ¥**: `WordCountResponse` DTO μƒμ„± + `GET /api/words/count` μ—”λ“ν¬μΈνΈ
2. **λ™κΈ°ν™” κΈ°λ¥**: `GET /api/words` + `GET /api/words/since` μ—”λ“ν¬μΈνΈ
3. **νƒ€μ„μ¤νƒ¬ν”„ λ³€ν™**: `long` β†’ `LocalDateTime` λ³€ν™ λ΅μ§

### μμƒ μ‘μ—… μ‹κ°„
- 1μμ„: μ•½ 30λ¶„
- 2μμ„: μ•½ 1μ‹κ°„
- 3μμ„: μ•½ 30λ¶„
- **μ΄ μμƒ μ‹κ°„**: μ•½ 2μ‹κ°„

---

## π“ μ°Έκ³ μ‚¬ν•­

1. **κ²½λ΅ λ¶μΌμΉ ν•΄κ²° λ°©λ²•**:
   - μµμ… A: λ°±μ—”λ“ κ²½λ΅λ¥Ό `/api/words`λ΅ λ³€κ²½ (κ¶μ¥)
   - μµμ… B: μ•λ“λ΅μ΄λ“ `WordApiService`μ κ²½λ΅λ¥Ό `/api/v1/words`λ΅ λ³€κ²½

2. **μ—λ¬ μ²λ¦¬**:
   - ν„μ¬ `WordController.saveWord()`μ²λΌ `try-catch`λ΅ κ°μ‹Έμ„ μΌκ΄€μ„± μ μ§€
   - λλ” `@ControllerAdvice`λ΅ μ „μ—­ μμ™Έ μ²λ¦¬ (μ„ νƒ)

3. **ν…μ¤νΈ**:
   - Postmanμ΄λ‚ curlλ΅ κ° μ—”λ“ν¬μΈνΈ ν…μ¤νΈ κ¶μ¥
   - νΉν `timestamp` νλΌλ―Έν„° ν•μ‹ ν™•μΈ ν•„μ”

